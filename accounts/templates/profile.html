{% extends "base.html" %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block title %}{{ user.username }}'s Profile{% endblock %}
{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h2>Statistics</h2>
        <span class="username">{{ user.username }}</span>
    </div>

    <!-- This new wrapper will hold our two main content panels -->
    <div class="profile-content">

        <!-- Panel 1: Key Statistics -->
        <div class="stats-panel">
            <div class="stat-item">
                <div class="stat-value">{{ profile.games_played }}</div>
                <div class="stat-label">Played</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ profile.win_percentage }}</div>
                <div class="stat-label">Win %</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ profile.current_streak }}</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ profile.max_streak }}</div>
                <div class="stat-label">Max Streak</div>
            </div>
        </div>

        <!-- Panel 2: Guess Distribution Chart -->
        <div class="distribution-panel">
            <h3>Guess Distribution</h3>
            <div class="distribution-chart">
                {% for count in profile.guess_distribution %}
                <div class="dist-row">
                    <div class="dist-label">{{ forloop.counter }}</div>
                    <div class="dist-bar-container">
                        {% widthratio count max_dist_value 100 as bar_width %}
                        <!-- We add a class if the count is zero for different styling -->
                        <div class="dist-bar {% if count > 0 %}has-wins{% endif %}" style="width: {{ bar_width }}%;">
                            <span class="dist-count">{{ count }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="profile-actions">
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="logout-link">Logout</button>
        </form>
    </div>
</div>
{% endblock %}